# node基础知识一

### 1、node 是什么？
Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。 同时提供了一些内置对象和方法。例如fs、http等内置对象，使得JS可以进行操作磁盘文件或搭建HTTP服务器。

什么是 V8？V8 JavaScript 引擎是 Google 用于其 Chrome 浏览器的底层 JavaScript 引擎。JavaScript 引擎负责解释并执行代码。Google 使用 V8 创建了一个用 C++ 编写的超快解释器，该解释器拥有另一个独特特征；您可以下载该引擎并将其嵌入任何 应用程序。V8 JavaScript 引擎并不仅限于在一个浏览器中运行。因此，Node 实际上会使用 Google 编写的 V8 JavaScript 引擎，并将其重建为可在服务器上使用。

而维基百科说：“Node.js 是谷歌 V8 引擎、libuv平台抽象层 以及主体使用 Javscript 编写的核心库三者集合的一个包装外壳。” （注：V8是谷歌开发的，目前公认最快的 Javascript 解析引擎，libuv 是一个开源的、为 Node 定制而生的跨平台的异步 IO 库。）

#### node与JavaScript的区别：
JavaScript是由三部分组成的：Ecmascript5（定义了该门语言的一些基础，例如：语法、数据类型、结构以及常用的对象） + DOM（是基于Ecmascript5扩展出的一些操作页面的方法）+ BOM（是基于Ecmascript5扩展出的一些操作浏览器的方法）

node：它也是以Ecmascript5为基础，扩展出一些操作系统或者网络的方法，比如：OS、file、net、database等

因此两者基础相同，只是拓展出来可操作的对象不同。

### 2、node 的作用

Node.js 的主要思路是：使用非阻塞的，事件驱动的 I/O 操作来保持在处理跨平台 (across distributed devices) 数据密集型实时应用时的轻巧高效。
#### （1）高并发
在理解这个高并发时，你需要了解一下传统web服务器是怎么处理浏览器的请求。

浏览器给网站发请求的过程一直没怎么变过。当浏览器给网站发了请求。服务器收到了请求，然后开始搜寻被请求的资源。如果有需要，服务器还会查询一下数据库，最后把响应结果传回浏览器。

不过以前传统的Apace服务器，它的工作原理是每当有一个网络请求到达，就 fork 出一个子进程并在子进程中运行 PHP 脚本来处理该请求。执行完脚本后再把结果发回客户端。这样可以确保不同进程之间互不干扰，即使一个进程出问题也不影响整个服务器，但是缺点也很明显:进程是一个比较重的概念，拥有自己的堆和栈，占用内存较多，一台服务器能运行的进程数量有上限，大约也就在几千左右。例如在 Java™ 和 PHP 这类语言中，每个连接都会生成一个新线程，每个新线程可能需要 2 MB 的配套内存。在一个拥有 8 GB RAM 的系统上，理论上最大的并发连接数量是 4,000 个用户。随着您的客户群的增长，如果希望您的 Web 应用程序支持更多用户，那么，您必须添加更多服务器。当然，这会增加服务器成本、流量成本和人工成本等成本。
并且每个连接都需要占一个进程，这些进程大部分时间都是闲着的，但是照样占用内存,消耗内存。

虽然 Apache 后来使用了 FastCGI，但本质上只是一个进程池，它减少了创建进程的开销，但无法有效提高并发数。

Java 的 Servlet 使用了线程池，即每个 Servlet 运行在一个线程上。线程虽然比进程轻量，但也是相对的。有人测试过，每个线程独享的栈的大小是 1M，依然不够高效。除此以外，多线程编程会带来各种麻烦，这一点想必程序员们都深有体会。

如果不使用线程，还有两种解决方案，分别是使用协程(coroutine)和非阻塞 I/O。协程比线程更加轻量，多个协程可以运行在同一个线程中，并由程序员自己负责调度，这种技术在 Go 语言中被广泛使用。而非阻塞 I/O 则被 Node.js 用来处理高并发的场景。

那么到底node是怎么解决这个问题的呢？

Node 解决这个问题的方法是：更改连接到服务器的方式。每个连接发射一个在 Node 引擎的进程中运行的事件，而不是为每个连接生成一个新的 OS 线程（并为其分配一些配套内存）（共同使用一个线程）。Node 声称它绝不会死锁，因为它根本不允许使用锁，它不会直接阻塞 I/O 调用。Node 还宣称，运行它的服务器能支持数万个并发连接。

#### （2）事件驱动

#### （3）非阻塞I/O (异步I/O)



### 3、node的缺点

#### （1）共享单一线程
首先, 大量的计算可能会使得 Node 的单线程暂时失去反应, 并导致所有的其他客户端的请求一直阻塞, 直到计算结束才恢复正常。 其次，开发人员需要非常小心，不要让一个 Exception 阻塞核心的事件循环，因为这将导致 Node.js 实例的终止（实际上就是程序崩溃）。（ 笔者注：如 PHP 中某个页面挂掉是不会影响网站运行的，但是 Nodejs 是一个线程一个线程来处理所有的链接，所以不论是计算卡了或者是被异常阻塞了都可能会影响到其他所有的链接。解决方案在稍后讨论。）

用来避免异常抛出时中断进程的方法是将异常使用回调传递出去（而不是抛出他们，就像在其他环境中一样）。即使一些未处理的异常阻塞了程序，依旧有多种应对的解决方案，而且也有很多可用于监视 Node 进程来执行必要的崩溃后恢复工作的策略和工具（虽然你将无法恢复用户的 Session ），最常见的是使用 Forever 模块，或者采用其他的外部系统工具如 upstart and monit。

#### (2)不适合 CPU 密集型的任务
Node.js 也有它的局限性，它并不适合 CPU 密集型的任务，比如人工智能方面的计算，视频、图片的处理等。


### 4、node最佳使用场景
#### （1）聊天
聊天应用程序是最能体现 Node.js 优点的例子：轻量级、高流量并且能良好的应对跨平台设备上运行密集型数据（虽然计算能力低）。同时，聊天也是一个非常值得学习的用例，因为它很简单，并且涵盖了目前为止一个典型的 Node.js 会用到的大部分解决方案。

#### （2）对象数据库接口
尽管，Node.js 确实非常擅长实时交互的应用，同时它也十分适合通过对象数据库（object DB）来查询数据（如 MongoDB）。以 JSON 格式存储的数据允许 Node.js 直接处理，不需要纠结数据转换和匹配的问题。

#### (3)队列输入

#### (4)数据流
#### (5)服务端web应用

### 5、node不适合的使用场景
#### （1）繁重的服务端的计算和处理
一般情况下，任何 CPU密集型操作 会削弱掉 Node通过事件驱动， 异步 I/O 模型等等带来的在吞吐量上的优势，因为当线程被非异步的高计算量占用时任何传入的请求将被阻塞。


















### 参考文档：
[Node.js 究竟是什么？](https://www.ibm.com/developerworks/cn/opensource/os-nodejs/)

[七天学会NodeJS](http://nqdeng.github.io/7-days-nodejs/#1.1)

[为什么要使用Node.js?](https://www.zcfy.cc/article/why-use-node-js-a-comprehensive-tutorial-with-examples-toptal)

[为什么我要用 Node.js? 案例逐一介绍](http://blog.jobbole.com/53736/)

[为什么要使用 Node.js](https://juejin.im/post/57b54f151532bc0063ebfe31)

[Node.js用来做什么？我们为什么要用它？](https://blog.csdn.net/ningtt/article/details/75008658)